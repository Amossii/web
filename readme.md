# 智能体应用开发

## 项目启动：

1. 安装后端的包，如flask，openai等
   1. pip install -r  requirement.txt
2. 配置项目数据库名字，通义千问的api-key，端口
3. 安装前端的包
   1. npm install
4. 启动项目
   1. python run.py
   2. npm run dev

## 项目简介和功能说明

**核心功能：**数据文件管理、模型管理、客户端系统、模型训练、房价预测、**智能agent**

> 本次项目主要目的为实现一个 智能体应用，我们选择房价预测为背景，主要结合了深度学习、模型训练、智能体、工具调用的方法来完成。
>
> 功能主要服务于房价模型训练和预测，完成了数据上传与处理、模型训练、房价预测以及agent智能预测的功能。模型训练方面，采用MLP自动化训练，为了提供模型训练语料，项目提供了完整的数据预处理和特征工程，最终实现一键自动训练并保存模型到数据库的功能。
>
> 为了方便用户使用模型的功能，编写了简单的前端可视化页面，用户可以在页面进行数据管理，模型管理等操作。
>
> 智能体方面，为了让用户能够更加方便地进行房价预测，项目加入了一个智能体agent，用户除了和其进行对话，它还集成了一个房价预测的工具，LLM可以调用房价预测的函数，用户输入房屋信息后，经过智能体整合，可以得到更具解释性的预测结果。

**技术栈:**

- 后端框架: Flask

- 数据库: MySQL + SQLAlchemy ORM

- 机器学习: LightGBM + scikit-learn + pandas

- AI 对话: 通义千问 API

- 配置管理: python-dotenv
- UI 框架:React 18 

- 构建工具:Vite 5 

- UI 组件库:Ant Design 5 
- 反向代理:nginx

**API**：

- 共23个 REST API 接口

- 涵盖健康检查、数据管理、模型管理、客户端操作、训练和评测

## 项目架构和模块说明：

项目架构：

> 整个项目可以粗略划分为后端+模型训练+前端，其中后端又包括了路由管理、数据库管理、文件处理、智能agent管理等等，模型训练模块包含了数据处理层、训练层、预测层，前端包含了视图层和服务层。

* 后端
  * 数据库管理-利用SQLAlchemy ORM管理数据库，实现数据持久化。
  * 路由接口管理-提供restfulAPI，管理路由路径，使得前端可以访问到相应的服务。
  * 文件处理-管理用户上传的文件，包括文件的下载、转码、存储等等。
  * 智能agent-提供大模型服务和工具服务，让用户可以更方便地访问大模型服务。
* 模型
  * 数据预处理-把原始excel文件处理成可以用于模型训练地csv文件。
  * 特征工程-选取对最终预测有用地标签并处理。
  * 训练-模型进行自动化训练
  * 预测-读取用户输入的数据，调用已经训练好的模型进行预测
* 前端
  * 视图层-主布局框架，包含侧边栏导航、顶部折叠按钮、内容区域、AI助手聊天组件（全局悬浮）
  * 服务层-统一的 HTTP 请求封装，包含：Axios 实例配置（baseURL、超时、拦截器）和5个API模块
* 智能体
  * 采用了通义千问的大模型api
  * 集成工具函数，智能调用

一个完整的工作流程是这样的

1. 上传数据 → 调用 datafile 路由，CSV 存入数据库

2. 创建客户端 → 调用 client 路由，创建一个 Client 记录

3. 绑定数据 → 把上传的数据文件绑定到客户端

4. 训练模型 → 客户端训练接口，自动调用 train 模块，生成模型并保存

5. 评测预测 → 传入房屋数据，用训练好的模型预测房价

6. 智能对话 → 通过 Agent 接口，用自然语言完成以上流程

按照模块，有课划分为配置模块、数据模型模块、路由模块、训练模块以及智能对话模块，其中，客户端作为中枢把数据和模型串起来，Agent 作为智能交互层让功能更加易用。

## 网络结构

Input
 ↓
Linear(num_dim + emb_dim → 256)
 ↓ ReLU
 ↓ BatchNorm
 ↓ Dropout(0.2)
 ↓
Linear(256 → 128)
 ↓ ReLU
 ↓ BatchNorm
 ↓ Dropout(0.2)
 ↓
Linear(128 → 1)

## 测试方案与结果分析：

**测试对象**：后端接口、前端页面、联邦学习效果

**测试方法**：单元测试、功能测试、接口测试、UI测试、兼容性测试。

| 测试对象 | 测试方法                | 测试结果                             |
| -------- | ----------------------- | ------------------------------------ |
| API      | 利用postman进行接口测试 | 全局23个接口功能正常，可以被前端访问 |
| 模块     | 主要用单元测试测试函数  | 正常                                 |
| 界面     | 对前端进行UI测试        | 界面正常                             |
| 兼容性   | 部署后在多端测试        | 部分浏览器上元素比例失调、访问速度慢 |
| 功能     | 功能测试                | 功能使用正常                         |

**结论**

* 功能正常访问，前后端应用都正常
* 但是在浏览器上可能出现页面变形的问题
* 文件上传速度慢，会导致前端响应时间变长，影响用户体验

## 项目界面展示

![image-20251214231310625](%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3.assets/image-20251214231310625.png)

![image-20251214231323563](%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3.assets/image-20251214231323563.png)

![image-20251214231335639](%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3.assets/image-20251214231335639.png)

![image-20251214231359258](%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3.assets/image-20251214231359258.png)

## 智能体对话：

![image-20251214235305676](%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3.assets/image-20251214235305676.png)

![image-20251214235427453](%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3.assets/image-20251214235427453.png)

![image-20251214235438779](%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3.assets/image-20251214235438779.png)